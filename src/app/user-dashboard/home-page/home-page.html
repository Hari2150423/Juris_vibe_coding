<div class="home-page-container">
  <div class="welcome-section">
    <h1>Welcome, {{ (currentUser | async)?.name }}!</h1>
    <p>Mark your roaster dates</p>
  </div>

  <!-- Submitted Selection Status Section -->
  <div class="submitted-selection-section" *ngIf="hasSubmittedSelection && submittedSelection">
    <div class="selection-status-card" [ngClass]="getSelectionStatusClass()">
      <div class="status-header">
        <h3>Your Roaster Selection</h3>
        <span class="status-badge">{{ getSelectionStatusText() }}</span>
      </div>
      <p class="submitted-time">
        Submitted: {{ formatSavedTime(submittedSelection.submittedAt!) }}
      </p>
      <div class="dates-summary">
        <p><strong>{{ submittedSelection.selectedDates.length }} dates selected</strong></p>
        <div class="dates-preview">
          <span class="date-chip" *ngFor="let dateStr of submittedSelection.selectedDates.slice(0, 3)">
            {{ formatDateString(dateStr) }}
          </span>
          <span *ngIf="submittedSelection.selectedDates.length > 3" class="more-dates">
            +{{ submittedSelection.selectedDates.length - 3 }} more
          </span>
        </div>
      </div>
      <div *ngIf="submittedSelection.status === 'rejected' && submittedSelection.adminComment" class="admin-comment">
        <h4>Admin Comment:</h4>
        <p>{{ submittedSelection.adminComment }}</p>
        <p class="resubmit-note">Please create a new selection to resubmit.</p>
      </div>
      <div *ngIf="submittedSelection.status === 'approved' && submittedSelection.adminComment" class="admin-comment approved">
        <h4>Admin Comment:</h4>
        <p>{{ submittedSelection.adminComment }}</p>
      </div>
    </div>
  </div>

  <!-- Draft Selection Info Section -->
  <div class="draft-selection-section" *ngIf="hasDraftSelection && !showEditMode && !hasSubmittedSelection">
    <div class="selection-info draft">
      <h3>Your Draft Roaster Selection</h3>
      <p class="saved-time">Draft saved: {{ formatSavedTime(draftSelectionSavedAt) }}</p>
      <div class="dates-summary">
        <p><strong>{{ draftSelectionDates.length }} dates selected</strong></p>
        <div class="dates-preview">
          <span class="date-chip" *ngFor="let date of draftSelectionDates.slice(0, 3)">
            {{ formatDate(date) }}
          </span>
          <span *ngIf="draftSelectionDates.length > 3" class="more-dates">
            +{{ draftSelectionDates.length - 3 }} more
          </span>
        </div>
      </div>
      <div class="action-buttons">
        <button class="edit-btn" (click)="enableEditMode()">
          Edit Selection
        </button>
        <button class="submit-btn" (click)="submitForReview()" [disabled]="isSubmitting">
          <i class="fas fa-paper-plane"></i>
          {{ isSubmitting ? 'Submitting...' : 'Submit to Review' }}
        </button>
      </div>
    </div>
  </div>
  
  <!-- Calendar Section -->
  <div class="calendar-section" *ngIf="(!hasDraftSelection && !hasSubmittedSelection) || showEditMode || (hasSubmittedSelection && submittedSelection?.status === 'rejected')">
    <div *ngIf="showEditMode" class="edit-mode-header">
      <h3>Edit Your Roaster Selection</h3>
      <p>Modify your previously selected dates below:</p>
      <button class="cancel-edit-btn" (click)="cancelEditMode()">
        Cancel Edit
      </button>
    </div>
    <div *ngIf="hasSubmittedSelection && submittedSelection?.status === 'rejected'" class="resubmit-header">
      <h3>Create New Roaster Selection</h3>
      <p>Your previous selection was rejected. Please create a new selection:</p>
    </div>
    <app-calender-ui 
      [editMode]="showEditMode" 
      [preSelectedDates]="showEditMode ? draftSelectionDates : []"
      (editCompleted)="onEditCompleted()"
      (draftSaved)="onDraftSaved()">
    </app-calender-ui>
  </div>

  <!-- Submit Confirmation Modal -->
  <div *ngIf="showSubmitModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-title-row">
        <h2>Confirm Your Dates</h2>
        <span class="selected-count-tag">{{ previousSelectionDates.length }} days selected</span>
      </div>
      <p>These are the chosen dates:</p>
      <ul>
        <li *ngFor="let date of previousSelectionDates"><span class="date-chip">{{ formatDate(date) }}</span></li>
      </ul>
      <p>Do you want to submit the above dates for admin approval?</p>
      <div class="modal-actions">
        <button class="edit-btn" (click)="confirmSubmit()">Confirm Submit</button>
        <button class="cancel-edit-btn" (click)="closeSubmitModal()">No</button>
      </div>
    </div>
  </div>
</div>
