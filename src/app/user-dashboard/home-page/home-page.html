<div class="home-page-container">
  <div class="welcome-section">
    <h1>Welcome, {{ (currentUser | async)?.name }}!</h1>
    <p>Mark your roaster dates</p>
  </div>

  <!-- Submitted Selection Status Section -->
  <div class="submitted-selection-section" *ngIf="hasSubmittedSelection && submittedSelection">
    <div class="selection-status-card" [ngClass]="getSelectionStatusClass()">
      <div class="status-header">
        <h3>Your Roaster Selection</h3>
        <span class="status-badge">{{ getSelectionStatusText() }}</span>
      </div>
      <p class="submitted-time">
        Submitted: {{ formatSavedTime(submittedSelection.submittedAt!) }}
      </p>
      <div class="dates-summary">
        <p><strong>{{ submittedSelection.selectedDates ? submittedSelection.selectedDates.length : 0 }} dates selected</strong></p>
        <button class="view-dates-btn" (click)="showAllDatesModal = true">View Selected Dates</button>
        <ng-container *ngIf="submittedSelection.attachment">
          <a class="attachment-link" [href]="'/uploads/' + submittedSelection.attachment" target="_blank" title="View Attachment">
            <span class="attachment-icon" style="font-size:1em;vertical-align:middle;font-style:italic;">
              ðŸ“Ž View Attachment
            </span>
          </a>
        </ng-container>
      </div>
      <div *ngIf="submittedSelection.status === 'rejected' && submittedSelection.adminComment" class="admin-comment">
        <h4>Admin Comment:</h4>
        <p>{{ submittedSelection.adminComment }}</p>
        <p class="resubmit-note">Please create a new selection to resubmit.</p>
      </div>
      <div *ngIf="submittedSelection.status === 'approved' && submittedSelection.adminComment" class="admin-comment approved">
        <h4>Admin Comment:</h4>
        <p>{{ submittedSelection.adminComment }}</p>
      </div>
    </div>
  </div>

  <!-- Draft Selection Info Section -->
  <div class="draft-selection-section" *ngIf="hasDraftSelection && !showEditMode && !hasSubmittedSelection">
    <div class="selection-info draft">
      <h3>Your Draft Roaster Selection</h3>
      <p class="saved-time">Draft saved: {{ formatSavedTime(draftSelectionSavedAt) }}</p>
      <div class="dates-summary">
        <p><strong>{{ draftSelectionDates.length }} dates selected</strong></p>
        <button class="view-dates-btn" (click)="showDraftDatesModal = true">View Selected Dates</button>
        <ng-container *ngIf="draftSelection && draftSelection.attachment">
          <a class="attachment-link" [href]="'/uploads/' + draftSelection.attachment" target="_blank" title="View Attachment">
            <span class="attachment-icon" style="font-size:1em;vertical-align:middle;font-style:italic;">
              ðŸ“Ž View Attachment
            </span>
          </a>
        </ng-container>
      </div>
      <div class="status-tag" *ngIf="status === 'pending'">
        <span class="info-tag info-pending">&#9432; Approval Pending</span>
      </div>
      <div class="status-tag" *ngIf="status === 'approved'">
        <span class="info-tag info-approved">&#10003; Approved</span>
      </div>
      <div class="action-buttons">
        <button class="edit-btn" (click)="enableEditMode()" [disabled]="isSubmitted">
          Edit Selection
        </button>
        <button class="submit-btn" (click)="openSubmitModal()">
          Submit
        </button>
      </div>
    </div>
  </div>
  
  <!-- Calendar Section -->
  <div class="calendar-section" *ngIf="(!hasDraftSelection && !hasSubmittedSelection) || showEditMode || (hasSubmittedSelection && submittedSelection?.status === 'rejected')">
    <div *ngIf="showEditMode" class="edit-mode-header">
      <h3>Edit Your Roaster Selection</h3>
      <p>Modify your previously selected dates below:</p>
      <button class="cancel-edit-btn" (click)="cancelEditMode()">
        Cancel Edit
      </button>
    </div>
    <div *ngIf="hasSubmittedSelection && submittedSelection?.status === 'rejected'" class="resubmit-header">
      <h3>Create New Roaster Selection</h3>
      <p>Your previous selection was rejected. Please create a new selection:</p>
    </div>
    <app-calender-ui 
      [editMode]="showEditMode" 
      [preSelectedDates]="showEditMode ? draftSelectionDates : []"
      (editCompleted)="onEditCompleted()"
      (draftSaved)="onDraftSaved()">
    </app-calender-ui>
  </div>

  <!-- Submit Confirmation Modal -->
  <div *ngIf="showSubmitModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-title-row">
        <h2>Confirm Your Dates</h2>
        <span class="selected-count-tag">{{ previousSelectionDates.length }} days selected</span>
      </div>
      <p *ngIf="previousSelectionDates.length > 0">These are the chosen dates:</p>
      <ul *ngIf="previousSelectionDates.length > 0">
        <li *ngFor="let date of previousSelectionDates"><span class="date-chip">{{ formatDate(date) }}</span></li>
      </ul>
      <p *ngIf="previousSelectionDates.length > 0">Do you want to submit the above dates for admin approval?</p>
      <p *ngIf="previousSelectionDates.length === 0">Do you want to submit your selection for admin approval?</p>
      <div class="modal-actions">
        <button class="edit-btn" (click)="confirmSubmit()">Confirm Submit</button>
        <button class="cancel-edit-btn" (click)="closeSubmitModal()">No</button>
      </div>
    </div>
  </div>

  <!-- All Selected Dates Modal (for submitted/pending/approved) -->
  <div *ngIf="showAllDatesModal" class="custom-modal-overlay">
    <div class="custom-modal-content">
      <div class="custom-modal-header">
        <h3>All Selected Dates</h3>
        <button class="close-modal-btn" (click)="showAllDatesModal = false">&times;</button>
      </div>
      <div class="custom-modal-body">
        <ul class="all-dates-list" *ngIf="(submittedSelection?.selectedDates?.length || 0) > 0">
          <li *ngFor="let dateStr of (submittedSelection?.selectedDates || [])">
            <span class="date-chip">{{ formatDateString(dateStr) }}</span>
          </li>
        </ul>
        <div *ngIf="!submittedSelection?.selectedDates || (submittedSelection?.selectedDates?.length || 0) === 0" class="no-dates-selected">No dates selected</div>
      </div>
    </div>
  </div>

  <!-- All Selected Dates Modal (for draft) -->
  <div *ngIf="showDraftDatesModal" class="custom-modal-overlay">
    <div class="custom-modal-content">
      <div class="custom-modal-header">
        <h3>All Selected Dates</h3>
        <button class="close-modal-btn" (click)="showDraftDatesModal = false">&times;</button>
      </div>
      <div class="custom-modal-body">
        <ul class="all-dates-list" *ngIf="draftSelectionDates.length > 0">
          <li *ngFor="let date of draftSelectionDates">
            <span class="date-chip">{{ formatDate(date) }}</span>
          </li>
        </ul>
        <div *ngIf="draftSelectionDates.length === 0" class="no-dates-selected">No dates selected</div>
      </div>
    </div>
  </div>
</div>
