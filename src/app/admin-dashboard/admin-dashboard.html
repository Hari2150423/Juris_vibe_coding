<div class="admin-dashboard">
  <!-- Header -->
  <header class="dashboard-header">
    <div class="container-fluid">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h1 class="dashboard-title">
            <i class="fas fa-tachometer-alt me-2"></i>Admin Dashboard
          </h1>
          <p class="welcome-text" *ngIf="currentAdmin">
            Welcome back, {{ currentAdmin.name }}!
          </p>
        </div>
        <div class="col-md-4 text-end">
          <button class="btn btn-outline-danger" (click)="logout()">
            <i class="fas fa-sign-out-alt me-2"></i>Logout
          </button>
        </div>
      </div>
    </div>
  </header>

  <div class="container-fluid mt-4">
    <!-- Statistics Cards -->
    <div class="row mb-4">
      <div class="col-md-3">
        <div class="stats-card">
          <div class="stats-icon users">
            <i class="fas fa-users"></i>
          </div>
          <div class="stats-content">
            <h3>{{ totalUsers }}</h3>
            <p>Total Users</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stats-card">
          <div class="stats-icon admins">
            <i class="fas fa-user-shield"></i>
          </div>
          <div class="stats-content">
            <h3>{{ totalAdmins }}</h3>
            <p>Total Admins</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stats-card">
          <div class="stats-icon bookings">
            <i class="fas fa-calendar-check"></i>
          </div>
          <div class="stats-content">
            <h3>{{ totalSubmissions }}</h3>
            <p>Pending Reviews</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stats-card">
          <div class="stats-icon active">
            <i class="fas fa-clock"></i>
          </div>
          <div class="stats-content">
            <h3>{{ usersNotSubmitted?.notSubmittedCount || 0 }}</h3>
            <p>Pending Submissions</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="row">
      <div class="col-12">
        <nav class="nav nav-tabs dashboard-tabs">
          <a class="nav-link" 
             [class.active]="activeTab === 'overview'" 
             (click)="setActiveTab('overview'); $event.preventDefault()">
            <i class="fas fa-chart-pie me-2"></i>Overview
          </a>
          <a class="nav-link" 
             [class.active]="activeTab === 'users'" 
             (click)="setActiveTab('users'); $event.preventDefault()">
            <i class="fas fa-users me-2"></i>User Management
          </a>
          <a class="nav-link" 
             [class.active]="activeTab === 'submissions'" 
             (click)="setActiveTab('submissions'); $event.preventDefault()">
            <i class="fas fa-paper-plane me-2"></i>Review Submissions
          </a>
          <a class="nav-link" 
             [class.active]="activeTab === 'pending'" 
             (click)="setActiveTab('pending'); $event.preventDefault()">
            <i class="fas fa-clock me-2"></i>Pending Submissions
          </a>
          <a class="nav-link" 
             [class.active]="activeTab === 'bookings'" 
             (click)="setActiveTab('bookings'); $event.preventDefault()">
            <i class="fas fa-calendar-alt me-2"></i>Approved Bookings
          </a>
          <a class="nav-link" 
             [class.active]="activeTab === 'settings'" 
             (click)="setActiveTab('settings'); $event.preventDefault()">
            <i class="fas fa-cog me-2"></i>Settings
          </a>
        </nav>
      </div>
    </div>

    <!-- Tab Content -->
    <div class="row mt-4">
      <div class="col-12">
        
        <!-- Overview Tab -->
        <div *ngIf="activeTab === 'overview'" class="tab-content">
          <div class="card">
            <div class="card-header">
              <h5><i class="fas fa-chart-line me-2"></i>System Overview</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6">
                  <h6>Recent Activity</h6>
                  <div class="recent-activity">
                    <div class="activity-item" *ngFor="let booking of selectedDatesData.slice(0, 5)">
                      <i class="fas fa-calendar-plus text-success"></i>
                      <span>Booking created by {{ booking.employeeId }} on {{ formatDate(booking.savedAt) }}</span>
                    </div>
                    <div *ngIf="selectedDatesData.length === 0" class="text-muted">
                      No recent activity
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <h6>Admin Permissions</h6>
                  <div class="permissions-list" *ngIf="currentAdmin && currentAdmin.permissions">
                    <span class="badge badge-permission me-1 mb-1" 
                          *ngFor="let permission of currentAdmin.permissions">
                      {{ permission.replace('_', ' ') | titlecase }}
                    </span>
                  </div>
                  <div *ngIf="!currentAdmin?.permissions" class="text-muted">
                    Standard admin permissions
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Users Management Tab -->
        <div *ngIf="activeTab === 'users'" class="tab-content">
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h5><i class="fas fa-users me-2"></i>User Management</h5>
              <button class="btn btn-primary btn-sm">
                <i class="fas fa-plus me-2"></i>Add New User
              </button>
            </div>
            <div class="card-body">
              
              <!-- Regular Users -->
              <h6 class="mb-3">Regular Users ({{ users.length }})</h6>
              <div class="table-responsive">
                <table class="table table-striped">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Name</th>
                      <th>Employee ID</th>
                      <th>Designation</th>
                      <th>Location</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let user of users">
                      <td>{{ user.id }}</td>
                      <td>{{ user.name }}</td>
                      <td>{{ user.employeeId }}</td>
                      <td>{{ user.designation }}</td>
                      <td>{{ user.location }}</td>
                      <td>
                        <button class="btn btn-sm btn-info me-1" 
                                (click)="viewUserBookings(user.id)"
                                title="View Bookings">
                          <i class="fas fa-calendar-alt"></i>
                        </button>
                        <button class="btn btn-sm btn-warning me-1" 
                                title="Edit User">
                          <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" 
                                (click)="deleteUser(user.id)"
                                title="Delete User">
                          <i class="fas fa-trash"></i>
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <!-- Admin Users -->
              <h6 class="mb-3 mt-4">Admin Users ({{ admins.length }})</h6>
              <div class="table-responsive">
                <table class="table table-striped">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Name</th>
                      <th>Employee ID</th>
                      <th>Designation</th>
                      <th>Location</th>
                      <th>Role</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let admin of admins">
                      <td>{{ admin.id }}</td>
                      <td>{{ admin.name }}</td>
                      <td>{{ admin.employeeId }}</td>
                      <td>{{ admin.designation }}</td>
                      <td>{{ admin.location }}</td>
                      <td><span class="badge bg-danger">{{ admin.role || 'admin' }}</span></td>
                      <td>
                        <button class="btn btn-sm btn-warning me-1" 
                                title="Edit Admin">
                          <i class="fas fa-edit"></i>
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Review Submissions Tab -->
        <div *ngIf="activeTab === 'submissions'" class="tab-content">
          <div class="card">
            <div class="card-header">
              <h5><i class="fas fa-paper-plane me-2"></i>Review User Submissions</h5>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-striped">
                  <thead>
                    <tr>
                      <th>Employee ID</th>
                      <th>Name</th>
                      <th>Designation</th>
                      <th>Location</th>
                      <th>Dates Count</th>
                      <th>Submitted</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let submission of submittedSelections">
                      <td>{{ submission.employeeId }}</td>
                      <td>
                        {{ getUserName(submission.userId) }}
                      </td>
                      <td>{{ submission.userDesignation }}</td>
                      <td>{{ submission.userLocation }}</td>
                      <td>{{ submission.selectedDates.length }}</td>
                      <td>{{ formatDateTime(submission.submittedAt!) }}</td>
                      <td>
                        <span class="badge" 
                              [ngClass]="{
                                'bg-warning': submission.status === 'pending',
                                'bg-success': submission.status === 'approved',
                                'bg-danger': submission.status === 'rejected'
                              }">
                          {{ submission.status | titlecase }}
                        </span>
                      </td>
                      <td>
                        <div class="btn-group" *ngIf="submission.status === 'pending'">
                          <button class="btn btn-sm btn-success" 
                                  (click)="approveSubmission(submission)"
                                  title="Approve">
                            <i class="fas fa-check"></i>
                          </button>
                          <button class="btn btn-sm btn-danger" 
                                  (click)="rejectSubmission(submission)"
                                  title="Reject">
                            <i class="fas fa-times"></i>
                          </button>
                        </div>
                        <button class="btn btn-sm btn-info" 
                                title="View Details"
                                *ngIf="submission.status !== 'pending'">
                          <i class="fas fa-eye"></i>
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
                <div *ngIf="submittedSelections.length === 0" class="text-center text-muted py-4">
                  No submissions found
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Pending Submissions Tab -->
        <div *ngIf="activeTab === 'pending'" class="tab-content">
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <div>
                <h5><i class="fas fa-clock me-2"></i>Users Who Haven't Submitted Roster Dates</h5>
                <div *ngIf="usersNotSubmitted" class="mt-2">
                  <small class="text-muted">
                    For {{ usersNotSubmitted.month }}/{{ usersNotSubmitted.year }} - 
                    {{ usersNotSubmitted.notSubmittedCount }} of {{ usersNotSubmitted.totalUsers }} users pending
                  </small>
                </div>
              </div>
              <button class="btn btn-sm btn-outline-primary" 
                      (click)="refreshDashboardData()"
                      title="Refresh Data">
                <i class="fas fa-sync-alt"></i>
              </button>
            </div>
            <div class="card-body">
              <div *ngIf="usersNotSubmitted && usersNotSubmitted.usersNotSubmitted.length > 0" class="table-responsive">
                <table class="table table-striped">
                  <thead>
                    <tr>
                      <th>Employee ID</th>
                      <th>Name</th>
                      <th>Designation</th>
                      <th>Location</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let user of usersNotSubmitted.usersNotSubmitted">
                      <td>{{ user.employeeId }}</td>
                      <td>{{ user.name }}</td>
                      <td>{{ user.designation }}</td>
                      <td>{{ user.location }}</td>
                      <td>
                        <span class="badge bg-warning text-dark">
                          <i class="fas fa-clock me-1"></i>Not Submitted
                        </span>
                      </td>
                      <td>
                        <div class="btn-group">
                          <button class="btn btn-sm btn-primary" 
                                  (click)="remindUser(user)"
                                  title="Send Reminder">
                            <i class="fas fa-bell"></i> Remind
                          </button>
                          <button class="btn btn-sm btn-info" 
                                  (click)="viewUserDetails(user)"
                                  title="View User Details">
                            <i class="fas fa-eye"></i>
                          </button>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div *ngIf="usersNotSubmitted && usersNotSubmitted.usersNotSubmitted.length === 0" 
                   class="text-center text-success py-4">
                <i class="fas fa-check-circle fa-3x mb-3"></i>
                <h4>All Users Have Submitted!</h4>
                <p class="text-muted">All users have submitted their roster dates for this month.</p>
              </div>
              <div *ngIf="!usersNotSubmitted" class="text-center py-4">
                <i class="fas fa-spinner fa-spin fa-2x"></i>
                <p class="mt-2">Loading pending submissions...</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Approved Bookings Tab -->
        <div *ngIf="activeTab === 'bookings'" class="tab-content">
          <div class="card">
            <div class="card-header">
              <h5><i class="fas fa-calendar-alt me-2"></i>Booking Management</h5>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-striped">
                  <thead>
                    <tr>
                      <th>Booking ID</th>
                      <th>Employee ID</th>
                      <th>Designation</th>
                      <th>Location</th>
                      <th>Dates Count</th>
                      <th>Month/Year</th>
                      <th>Created</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let booking of selectedDatesData">
                      <td>{{ booking.id }}</td>
                      <td>{{ booking.employeeId }}</td>
                      <td>{{ booking.userDesignation }}</td>
                      <td>{{ booking.userLocation }}</td>
                      <td>{{ booking.selectedDates.length }}</td>
                      <td>{{ booking.month }}/{{ booking.year }}</td>
                      <td>{{ formatDateTime(booking.savedAt) }}</td>
                      <td>
                        <button class="btn btn-sm btn-info me-1" 
                                title="View Details">
                          <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-warning me-1" 
                                title="Edit Booking">
                          <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" 
                                (click)="deleteBooking(booking.id)"
                                title="Delete Booking">
                          <i class="fas fa-trash"></i>
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
                <div *ngIf="selectedDatesData.length === 0" class="text-center text-muted py-4">
                  No bookings found
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Settings Tab -->
        <div *ngIf="activeTab === 'settings'" class="tab-content">
          <div class="card">
            <div class="card-header">
              <h5><i class="fas fa-cog me-2"></i>System Settings</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6">
                  <h6>Admin Profile</h6>
                  <div class="admin-profile" *ngIf="currentAdmin">
                    <p><strong>Name:</strong> {{ currentAdmin.name }}</p>
                    <p><strong>Employee ID:</strong> {{ currentAdmin.employeeId }}</p>
                    <p><strong>Designation:</strong> {{ currentAdmin.designation }}</p>
                    <p><strong>Location:</strong> {{ currentAdmin.location }}</p>
                    <p><strong>Role:</strong> {{ currentAdmin.role || 'admin' }}</p>
                  </div>
                  <button class="btn btn-primary">Update Profile</button>
                </div>
                <div class="col-md-6">
                  <h6>System Actions</h6>
                  <div class="d-grid gap-2">
                    <button class="btn btn-outline-primary">Export Data</button>
                    <button class="btn btn-outline-secondary">Import Data</button>
                    <button class="btn btn-outline-info">Generate Reports</button>
                    <button class="btn btn-outline-warning">Backup System</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>
